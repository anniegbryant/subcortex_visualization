{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Subcortex visualization software","text":"<p>Welcome to the documentation for subcortical visualization software! This package is implemented in both Python (<code>subcortex_visualization</code>) and R (<code>subcortexVisualizationR</code>) and currently includes the following nine subcortical, thalamic, and cerebellar atlases for data visualization in two-dimensional vector graphics:</p> <p></p> <p>All code can be found in the corresponding GitHub repository.</p> <p>More information about these atlases, including the process of rendering the surfaces and tracing the outlines for each, can be found in the Atlas information directory.</p>"},{"location":"R_tutorial/","title":"subcortexVisualizationR tutorial","text":"<p>2026-01-29</p>"},{"location":"R_tutorial/#load-required-packages","title":"Load required packages","text":"<pre><code>library(subcortexVisualizationR)\n</code></pre> <pre><code>## Loading required package: tidyverse\n\n## \u2500\u2500 Attaching core tidyverse packages \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 tidyverse 2.0.0 \u2500\u2500\n## \u2714 dplyr     1.1.4     \u2714 readr     2.1.6\n## \u2714 forcats   1.0.1     \u2714 stringr   1.6.0\n## \u2714 ggplot2   4.0.1     \u2714 tibble    3.3.1\n## \u2714 lubridate 1.9.4     \u2714 tidyr     1.3.2\n## \u2714 purrr     1.2.1     \n## \u2500\u2500 Conflicts \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 tidyverse_conflicts() \u2500\u2500\n## \u2716 dplyr::filter() masks stats::filter()\n## \u2716 dplyr::lag()    masks stats::lag()\n## \u2139 Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n</code></pre> <pre><code>library(tidyverse)\n</code></pre>"},{"location":"R_tutorial/#example-data-just-to-show-the-different-regions","title":"Example data just to show the different regions","text":"<p>First, let\u2019s create a simple dataframe with the left hemisphere cortical regions, assigning a different value to each region for visual clarity. Note that all data passed to <code>plot_subcortical_data</code> needs to follow the same three-column structure as shown below: <code>region</code> (the name of the subcortical region with the same nomenclature as shown), <code>value</code> (the value to be plotted in the subcortex map), and <code>Hemisphere</code> (either \u2018L\u2019, \u2018R\u2019, or \u2018both\u2019).</p> <pre><code># Set seed for reproducibility\n\nexample_subcortex_data = data.frame(region = c(\"accumbens\", \"amygdala\", \n                                               \"caudate\", \"hippocampus\", \n                                               \"pallidum\", \"putamen\", \n                                               \"thalamus\"),\n                                    value = 1:7,\n                                    Hemisphere = \"L\")\n\nexample_subcortex_data\n</code></pre> <pre><code>##        region value Hemisphere\n## 1   accumbens     1          L\n## 2    amygdala     2          L\n## 3     caudate     3          L\n## 4 hippocampus     4          L\n## 5    pallidum     5          L\n## 6     putamen     6          L\n## 7    thalamus     7          L\n</code></pre> <p>Now, we can plot this data with the <code>plasma</code> colormap as an example in the left cortex. Note the following arguments:</p> <ul> <li><code>subcortex_data</code>: The three-column data.frame shown above</li> <li><code>atlas</code>: The name of the atlas to plot</li> <li><code>line_thickness</code>: How thick the lines around each subcortical region   should be drawn, in mm (default is 0.5)</li> <li><code>line_color</code>: What color the lines around each subcortical region   should be (default is \u2018black\u2019)</li> <li><code>hemisphere</code>: Which hemisphere (\u2018L\u2019 or \u2018R\u2019) the <code>subcortex_data</code> is   from; can also be \u2018both\u2019 (default is \u2018L\u2019)</li> <li><code>fill_title</code>: Name to add to legend</li> <li><code>cmap</code>: Name of colormap (e.g., \u2018plasma\u2019 or \u2018viridis\u2019) or a   <code>matplotlib.colors.Colormap</code> (default is \u2018viridis\u2019)</li> <li><code>vmin</code>: Min fill value; this is optional, and you would only want to   use this to manually constrain the fill range to match another figure</li> <li><code>vmax</code>: Max fill value; this is optional, and you would only want to   use this to manually constrain the fill range to match another figure</li> </ul> <pre><code>plot_subcortical_data(subcortex_data=example_subcortex_data, atlas = 'aseg',\n                      line_thickness=0.5, line_color='black',\n                          hemisphere='L', fill_title = \"aseg region index\", cmap='plasma', \n                          vmin=NA, vmax=NA)\n</code></pre> <pre><code>## SVG contains a tag not currently handled: &lt;namedview&gt;\n\n## Joining with `by = join_by(region, Hemisphere, face)`\n## Joining with `by = join_by(region, Hemisphere)`\n</code></pre> <p></p> <p>If we wanted to plot this with the <code>inferno</code> color palette instead, just swap out the <code>cmap</code> argument values:</p> <pre><code>plot_subcortical_data(subcortex_data=example_subcortex_data, atlas = 'aseg', \n                      hemisphere='L', fill_title = \"aseg region index\", cmap='inferno')\n</code></pre> <pre><code>## SVG contains a tag not currently handled: &lt;namedview&gt;\n\n## Joining with `by = join_by(region, Hemisphere, face)`\n## Joining with `by = join_by(region, Hemisphere)`\n</code></pre> <p></p> <p>By default, <code>plot_subcortical_data</code> will plot the index values of each region, so we actually don\u2019t need to pass in a dataframe for this visualization purpose. Here, we can plot the region indices for the Melbourne Subcortex S1 atlas in the right hemisphere without passing in any data:</p> <pre><code>plot_subcortical_data(atlas = 'Melbourne_S1', hemisphere='R', \n                      fill_title = \"Melbourne Subcortex S1 atlas region\", \n                      cmap='viridis')\n</code></pre> <pre><code>## SVG contains a tag not currently handled: &lt;namedview&gt;\n\n## Joining with `by = join_by(region, Hemisphere, face)`\n</code></pre> <p></p> <p>To plot both hemispheres using gray lines at thickness 1.0, we can set the <code>hemisphere</code> argument to \u2018both\u2019 and adjust the <code>line_thickness</code> and <code>line_color</code> arguments accordingly:</p> <pre><code>plot_subcortical_data(atlas = 'Melbourne_S1', hemisphere='both', \n                      line_color='gray', line_thickness=1,\n                      fill_title = \"Melbourne Subcortex S1 atlas region\", cmap='viridis')\n</code></pre> <pre><code>## SVG contains a tag not currently handled: &lt;namedview&gt;\n\n## Joining with `by = join_by(region, Hemisphere, face)`\n</code></pre> <p></p> <p>We can also use the S2 level of granularity from the Melbourne Subcortex (Tian 2020) Atlas:</p> <pre><code>plot_subcortical_data(atlas = 'Melbourne_S2', hemisphere='both', \n                      fill_title = \"Melbourne Subcortex S2 atlas\", cmap=rainbow)\n</code></pre> <pre><code>## SVG contains a tag not currently handled: &lt;namedview&gt;\n\n## Joining with `by = join_by(region, Hemisphere, face)`\n</code></pre> <p></p> <p>Lastly, let\u2019s view the atlas for (1) AICHA subcortex; (2) Brainnetome subcortex; and (3) SUIT cerebellum:</p> <pre><code># AICHA\nplot_subcortical_data(atlas = 'AICHA', hemisphere='both', \n                      fill_title = \"AICHA subcortex atlas\", cmap=rainbow)\n</code></pre> <pre><code>## SVG contains a tag not currently handled: &lt;namedview&gt;\n\n## Joining with `by = join_by(region, Hemisphere, face)`\n</code></pre> <p></p> <pre><code># Brainnetome\nplot_subcortical_data(atlas = 'Brainnetome', hemisphere='both', \n                      fill_title = \"Brainnetome subcortex atlas\", cmap=rainbow)\n</code></pre> <pre><code>## SVG contains a tag not currently handled: &lt;namedview&gt;\n\n## Joining with `by = join_by(region, Hemisphere, face)`\n</code></pre> <p></p> <pre><code># SUIT cerebellum\nplot_subcortical_data(atlas = 'SUIT_cerebellar_lobule', hemisphere='both', \n                      fill_title = \"SUIT cerebellum atlas\", cmap=rainbow)\n</code></pre> <pre><code>## [1] \"Individual-hemisphere visualization is not supported with the SUIT cerebellar lobule atlas. Rendering both hemispheres together, along with the vermis.\"\n\n## SVG contains a tag not currently handled: &lt;namedview&gt;\n\n## Joining with `by = join_by(region, Hemisphere, face)`\n</code></pre> <p></p>"},{"location":"R_tutorial/#simulating-and-visualizing-continuous-data","title":"Simulating and visualizing continuous data","text":"<pre><code>set.seed(127)\n\n\n\nexample_continuous_data_L &lt;- data.frame(region = c(\"accumbens\", \"amygdala\", \n                                                \"caudate\", \"hippocampus\", \n                                                \"pallidum\", \"putamen\", \n                                                \"thalamus\"),\n                                       Hemisphere = 'L',\n                                    value = rnorm(7))\n\nexample_continuous_data_R &lt;- data.frame(region = c(\"accumbens\", \"amygdala\", \n                                                \"caudate\", \"hippocampus\", \n                                                \"pallidum\", \"putamen\", \n                                                \"thalamus\"),\n                                       Hemisphere = 'R',\n                                    value = rnorm(7))\n\n\nexample_continuous_data &lt;- rbind(example_continuous_data_L, example_continuous_data_R)\n\n\n# See what the left hemisphere data, randomly sampled from a normal distribution, looks like\nexample_continuous_data\n</code></pre> <pre><code>##         region Hemisphere        value\n## 1    accumbens          L -0.567733740\n## 2     amygdala          L -0.814760579\n## 3      caudate          L -0.493939596\n## 4  hippocampus          L  0.001818846\n## 5     pallidum          L  0.819784933\n## 6      putamen          L  0.996757858\n## 7     thalamus          L  0.751782219\n## 8    accumbens          R -0.125547223\n## 9     amygdala          R  0.564619888\n## 10     caudate          R  0.133508557\n## 11 hippocampus          R -0.105963209\n## 12    pallidum          R  0.605929618\n## 13     putamen          R  0.013250975\n## 14    thalamus          R -0.278788699\n</code></pre> <p>Plot the left hemisphere:</p> <pre><code>plot_subcortical_data(subcortex_data=example_continuous_data_L, atlas = 'aseg',\n                      hemisphere='L', fill_title = \"Normal distribution sample, aseg atlas\", \n                      cmap='viridis')\n</code></pre> <pre><code>## SVG contains a tag not currently handled: &lt;namedview&gt;\n\n## Joining with `by = join_by(region, Hemisphere, face)`\n## Joining with `by = join_by(region, Hemisphere)`\n</code></pre> <p></p> <p>Right hemisphere:</p> <pre><code>plot_subcortical_data(subcortex_data=example_continuous_data_R, atlas = 'aseg',\n                      hemisphere='R', fill_title = \"Normal distribution sample, aseg atlas\", \n                      cmap='viridis')\n</code></pre> <pre><code>## SVG contains a tag not currently handled: &lt;namedview&gt;\n\n## Joining with `by = join_by(region, Hemisphere, face)`\n## Joining with `by = join_by(region, Hemisphere)`\n</code></pre> <p></p> <p>Both hemispheres together:</p> <pre><code>plot_subcortical_data(subcortex_data=example_continuous_data, atlas = 'aseg', \n                      hemisphere='both', fill_title = \"Normal distribution sample, aseg atlas\", \n                      cmap='viridis')\n</code></pre> <pre><code>## SVG contains a tag not currently handled: &lt;namedview&gt;\n\n## Joining with `by = join_by(region, Hemisphere, face)`\n## Joining with `by = join_by(region, Hemisphere)`\n</code></pre> <p></p> <p>You can pass in a custom colormap too! For example, if you want to fill in with a gradient ranging from white to purple:</p> <pre><code>plot_subcortical_data(subcortex_data=example_continuous_data, atlas = 'aseg', \n                      hemisphere='both', fill_title = \"Normal distribution sample\", \n                      cmap=c('white', '#76167D'))\n</code></pre> <pre><code>## SVG contains a tag not currently handled: &lt;namedview&gt;\n\n## Joining with `by = join_by(region, Hemisphere, face)`\n## Joining with `by = join_by(region, Hemisphere)`\n</code></pre> <p></p> <p>Since this data has positive and negative values,</p> <p>Since this data has positive and negative values, we can pass in a color palette from blue (negative) to white (0) to red (positive). <code>plot_subcortical_data</code> takes an argument <code>midpoint</code> that specifies the center point for the color palette. Setting this to 0 here enforces the center value to be white. Without setting vmin/vmax explicitly, the color range will be defined symmetrically around <code>midpoint</code> to capture the full range of the data.</p> <pre><code>plot_subcortical_data(subcortex_data=example_continuous_data, atlas = 'aseg',  \n                      hemisphere='both', fill_title = \"Normal distribution sample\", \n                      cmap=c(\"blue\", \"white\", \"red\"), midpoint=0)\n</code></pre> <pre><code>## SVG contains a tag not currently handled: &lt;namedview&gt;\n\n## Joining with `by = join_by(region, Hemisphere, face)`\n## Joining with `by = join_by(region, Hemisphere)`\n</code></pre> <p></p>"},{"location":"acknowledgments/","title":"Acknowledgments","text":"<p>Thank you very much to Chris Rorden, Ye Tian, and Sid Chopra for their suggestions and continued development of open tools for neuroimaging visualization that enabled development of this project!</p> <p>We're also very grateful for ongoing contributions from members of the GitHub community: </p> <p></p>"},{"location":"atlas_info/","title":"Information about the included subcortical atlases","text":""},{"location":"atlas_info/#aseg-freesurfer","title":"aseg (FreeSurfer)","text":"<p>Reference: Fischl et al. Neuron (2002). </p> <p>Atlas name keyword: <code>aseg</code></p> <p>Region names: accumbens, amygdala, caudate, hippocampus, pallidum, putamen, thalamus</p> <p></p>"},{"location":"atlas_info/#melbourne-subcortex-atlas-s1","title":"Melbourne Subcortex Atlas (S1)","text":"<p>Reference: Tian et al. Nature Neuroscience (2020).</p> <p>Atlas name keyword: <code>Melbourne_S1</code></p> <p>Region names: accumbens, amygdala, caudate, hippocampus, pallidum, putamen, thalamus_anterior, thalamus_posterior</p> <p></p>"},{"location":"atlas_info/#melbourne-subcortex-atlas-s2","title":"Melbourne Subcortex Atlas (S2)","text":"<p>Reference: Tian et al. Nature Neuroscience (2020).</p> <p>Atlas name keyword: <code>Melbourne_S2</code></p> <p>Region names: accumbens_core, accumbens_shell, amygdala_lateral, amygdala_medial, caudate_anterior, caudate_posterior, hippocampus_anterior, hippocampus_posterior, pallidum_anterior, pallidum_posterior, putamen_anterior, putamen_posterior, thalamus_DA, thalamus_DP, thalamus_VA, thalamus_VP</p> <p></p>"},{"location":"atlas_info/#melbourne-subcortex-atlas-s3","title":"Melbourne Subcortex Atlas (S3)","text":"<p>Reference: Tian et al. Nature Neuroscience (2020).</p> <p>Atlas name keyword: <code>Melbourne_S3</code></p> <p>Region names: accumbens_core, accumbens_shell, amygdala_lateral, amygdala_medial, caudate_anterior, caudate_posterior, hippocampus_anterior, hippocampus_posterior, pallidum_anterior, pallidum_posterior, putamen_anterior, putamen_posterior, thalamus_DA, thalamus_DP, thalamus_VA, thalamus_VP</p> <p></p>"},{"location":"atlas_info/#melbourne-subcortex-atlas-s4","title":"Melbourne Subcortex Atlas (S4)","text":"<p>Reference: Tian et al. Nature Neuroscience (2020).</p> <p>Atlas name keyword: <code>Melbourne_S4</code></p> <p>Region names: accumbens_core, accumbens_shell, amygdala_lateral, amygdala_medial, caudate_anterior, caudate_posterior, hippocampus_anterior, hippocampus_posterior, pallidum_anterior, pallidum_posterior, putamen_anterior, putamen_posterior, thalamus_DA, thalamus_DP, thalamus_VA, thalamus_VP</p> <p></p>"},{"location":"atlas_info/#aicha-subcortical-atlas","title":"AICHA subcortical atlas","text":"<p>Reference: Joliot et al. J Neurosci Methods (2015).</p> <p>Atlas name keyword: <code>AICHA</code></p> <p>Region names: Amygdala-1,  Caudate-1,  Caudate-2,  Caudate-3,  Caudate-4,  Caudate-5,  Caudate-6,  Caudate-7,  Pallidum-1,  Putamen-2,  Putamen-3,  Thalamus-1,  Thalamus-2,  Thalamus-3,  Thalamus-4,  Thalamus-5,  Thalamus-6,  Thalamus-7,  Thalamus-8,  Thalamus-9 </p> <p></p>"},{"location":"atlas_info/#brainnetome-subcortical-atlas","title":"Brainnetome subcortical atlas","text":"<p>Reference: Fan et al. Cerebral Cortex (2016).</p> <p>Atlas name keyword: <code>Brainnetome</code></p> <p>Region names: GP, NAC, Otha, PPtha, Stha, cHipp, cTtha, dCa, dlPu, lAmyg, lPFtha, mAmyg, mPFtha, mPMtha, rHipp, rTtha, vCa, vmPu</p> <p></p>"},{"location":"atlas_info/#thalamus-nuclei-hcp-atlas","title":"Thalamus Nuclei (HCP) atlas","text":"<p>Reference: Najdenovska et al. Scientific Data (2018).</p> <p>Atlas name keyword: <code>Thalamus_Nuclei_HCP</code></p> <p>Region names: Anterior, Central_Lateral-Lateral_Posterior-Medial_Pulvinar, Medio_Dorsal, Pulvinar, Ventral_Anterior, Ventral_Latero_Dorsal, Ventral_Latero_Ventral</p> <p></p>"},{"location":"atlas_info/#suit-cerebellar-atlas","title":"SUIT cerebellar atlas","text":"<p>Reference: Diedrichson. Neuroimage (2006).</p> <p>Atlas name keyword: <code>SUIT</code></p> <p>Region names: I_IV, V, VI, VI_vermis, Crus_I, Crus_II, Crus_II_vermis, VIIb, VIIb_vermis, VIIIa, VIIIa_vermis, VIIIb, VIIIb_vermis, IX, IX_vermis, X, X_vermis</p> <p></p>"},{"location":"citation/","title":"Cite this package","text":"<p>If you use this package in a scientific publication, blog post, etc., please cite the corresponding Zenodo release as follows:</p> <p>Annie G. Bryant. (2025). anniegbryant/subcortex_visualization: Initial Zenodo release (initial_release). Zenodo. https://doi.org/10.5281/zenodo.15385316</p>"},{"location":"custom_segmentation/","title":"Using a custom atlas","text":""},{"location":"custom_segmentation/#overview","title":"Overview","text":"<p>While this package comes with nine subcortical and cerebellar atlases, you can add any new segmentation (cortical or non-cortical) through three-dimensional (3D) mesh rendering and manual tracing. We have a dedicated folder for a custom segmentation pipeline that will walk you through the two key steps:  </p> <ol> <li>Rendering a series of surface meshes from your parcellation atlas (starting from a .nii.gz volume), using the <code>surfice_atlas</code> visualization software developed by the lab of Professor Chris Rorden (see Rorden 2025, Nature Methods); and </li> <li>Tracing the outline of each region in the rendered mesh in vector graphic editing software (we use Inkscape in the tutorial as a powerful and free option), to yield a two-dimensional image of your atlas in scalable vector graphic (.svg) format.</li> </ol> <p>If you use a particular segmentation atlas in your research and would like to visualize data in that atlas in two dimensions, you can follow along with this guide. These are the exact same steps we implemented to generate the segmentation visuals included in this visualization package for all atlases.</p>"},{"location":"custom_segmentation/#step-1-creating-and-visualizing-a-custom-triangulated-mesh-from-a-volumetric-segmentationparcellation","title":"\ud83e\udde0 Step 1. Creating and visualizing a custom triangulated mesh from a volumetric segmentation/parcellation","text":"<p>First, you'll want to convert from your 3D segmentation atlas (stored as a NIFTI image) to a triangulated mesh rendering. There are some very helpful existing resources out there on this step:  </p> <ul> <li>Madan (2015) provides a comprehensive tutorial for constructing 3D surface meshes from a volumetric atlas using a combination of ITK-SNAP and ParaView programs, which are helpful for users who prefer a graphical user interface (GUI)-based approach </li> <li>The NiiVue package offers excellent resources for web-based surface mesh rendering; for example, the SUIT probabilistic cerebellar lobule atlas is rendered as a mesh with interactive viewing options at https://niivue.com/demos/features/mesh.atlas.suit.html</li> </ul> <p>For users who prefer a programmatic Python-based approach, we will walk through a solution developed by the lab of Professor Chris Rorden that makes use of two of their Python scripts:  </p> <ol> <li>niiAtlas2mesh.py</li> <li>combinemz3.py</li> </ol> <p>This method will generate one color-coded 3D mesh file (<code>.mz3</code>) for your segmentation, which can then be rendered interactively in the <code>Surf Ice</code> GUI software (described in more detail in Rorden Nature Methods, 2025).</p>"},{"location":"custom_segmentation/#generating-the-mz3-file-in-python","title":"Generating the .mz3 file in Python","text":"<p>We provide a straightforward python script, <code>volume_to_mesh_mz3.py</code>, that allows you to pass in your segmentation volume (in NIfTI format) and generates the <code>.mz3</code> color-coded 3D surface mesh.  It can be run as follows:</p> <pre><code>python volume_to_mesh_mz3.py \\\n    --input_volume Tian_Subcortex_S1_3T_1mm.nii.gz \\\n    --output_path mesh_outputs/ --out_file Tian_Subcortex_S1_3T_1mm.mz3 \\\n    --index_max 8 --colors plasma_8_colors.txt --delete_mz3\n</code></pre> <p>Where: </p> <ul> <li><code>input_volume</code> is your volumetric segmentation (here, we use the S1 resolution from the Melbourne Subcortical Atlas as an example; see Tian et al. Nature Neuroscience, 2020)</li> <li><code>output_path</code> (optional) is a working directory where individual <code>.mz3</code> files can be saved per region; these can be deleted.</li> <li><code>out_file</code> (optional) is the name for your final generated <code>.mz3</code> file. </li> <li><code>index_max</code> (optional) is the maximum segmentation index you want to use; for example, if you have eight regions per hemisphere, setting this to 8 means the mesh will only be for one hemisphere (Right hemisphere in this case). You can also set an <code>index_min</code> for the same purpose.</li> <li><code>colors</code> (optional) is an RGBA color lookup table for custom control over the mesh colors. </li> <li><code>delete_mz3</code> is an optional flag to delete intermediate <code>.mz3</code> files that were generated for each region in <code>output_path</code>.</li> </ul> <p>The default color scheme comes from <code>colors.txt</code>, but it's very straightforward to make your own custom colormap.  Any colormap can be used, and the number of discrete colors to sample should be set to match the number of subregions in the given atlas and number of hemispheres---for example, for the left subcortex in the Melbourne S2 atlas, 16 colors should be sampled. Here's how to select 8 evenly-spaced shades across the <code>plasma</code> colormap from <code>Matplotlib</code>, which we used for the Melbourne S1 right-hemisphere surface example:</p> <pre><code>import numpy as np\nimport matplotlib\n\ncmap = matplotlib.colormaps.get_cmap('plasma') # Use plasma colormap\ncolors = cmap(np.linspace(0, 1, 8)) # Sample 8 colors\nrgb_colors = colors[:, :3] # Extract RGB (no alpha)\nrgb_256 = (rgb_colors * 256).astype(int) # 0-256 scaling\nnp.savetxt('my_colors.txt', rgb_256, fmt='%d') # Save colors to .txt file\n</code></pre> <p>Generally speaking, we recommend separating out the two hemispheres for maximum visibility along the medial face (i.e., so medial areas are not obstructed by the opposite hemisphere). If there are substantial structural differences between the left and right hemispheres, this process should be repeated separately for each hemisphere; otherwise, the traced regions can simply be mirrored along the horizontal axis, though one should still use the appropriate region name suffixes as discussed below.</p>"},{"location":"custom_segmentation/#visualizing-the-3d-mesh","title":"Visualizing the 3D mesh","text":"<p>Once you have your combined 3D mesh in <code>.mz3</code> format (in our example, that's <code>Tian_Subcortex_S1_3T_1mm.mz3</code>), you can visualize this using the <code>Surf Ice</code> GUI software.</p> <p>Boot up Surf Ice and open the <code>Tian_Subcortex_S1_3T_1mm.mz3</code> file (using File &gt; Open to select Tian_Subcortex_S1_3T_1mm.mz3), and you should have a color-coded three-dimensional mesh rendered on your screen.</p> <p></p> <p>If you use this method, we recommend rotating the object until you reach the desired angle(s) for generating your two-dimensional atlas, then taking a screenshot from the medial and lateral perspectives.</p>"},{"location":"custom_segmentation/#step-2-tracing-the-outline-of-each-region-in-vector-graphic-editing-software","title":"\ud83c\udfa8 Step 2. Tracing the outline of each region in vector graphic editing software","text":""},{"location":"custom_segmentation/#creating-outlines-for-each-region","title":"Creating outlines for each region","text":"<p>Next, pour yourself a big mug of coffee to sit and trace the outline of each region in Inkscape (or a similar vector graphic editing program) \u2615\ufe0f We'll walk you through the steps using Inkscape.</p> <p>Open up a new image (.svg) in Inkscape, and import the PNG snapshot generated from the above rendered mesh by either clicking <code>\u2318+I</code> (Mac) or <code>Ctrl+I</code> (Windows), or <code>File &gt; Import</code>. We'll use the 'Freehand lines' tool for tracing, which looks like the following along your toolbar:</p> <p></p> <p>And then go ahead and trace your first region in your image! We recommend setting 'Smoothing' in your top toolbar to around 20-25 (we use 25.0 in this example), which means that you can do a pretty quick first pass at tracing each region and the path won't stick to every bump you draw.</p> <p></p> <p>Once you finish your first trace, if you want to edit any of the points in the path, just double-click on the black line and you can click and drag the points to adjust their spacing. Rinse and repeat: go ahead and trace the outline for all of the regions in your atlas. Once you finish, when you take away the 3D mesh PNG underneath, you should have a set of outlines that resemble a minimalist aesthetic line-art tattoo like so:</p> <p></p>"},{"location":"custom_segmentation/#labeling-each-region-in-the-svg-metadata","title":"Labeling each region in the SVG metadata","text":"<p>After you finish tracing the outline for each region, you can store the name of that region along with the face (medial or lateral) and hemisphere (right or left) to identify that region programmatically in python. In Inkscape, you can accomplish this by selecting a given region (here, the left putamen shown on the lateral face). In the 'Object Properties' pane shown on the right, in the 'Title' text box, you should then put the name of the region (e.g., 'putamen'), face (e.g., 'lateral'), and hemisphere (e.g., 'R'), all as one string separated by underscores, as shown in the screenshot. In other words, for the highlighted region, its title should be 'putamen_lateral_R':</p> <p></p> <p>Once you add the title to each region, congrats, you've finished creating the vector graphic for the given hemisphere for your custom atlas!</p>"},{"location":"custom_segmentation/#repeating-for-the-other-hemisphere","title":"Repeating for the other hemisphere","text":"<p>You may notice that the above SVG image is saved as 'Melbourne_S1_R.svg', which indicates that this file corresponds to the Melbourne Subcortex Atlas at granularity level S1 in the Right hemisphere (R).</p> <p>If your atlas is left-right symmetric, you can just copy-paste the SVG objects into a new file named e.g., 'Melbourne_S1_L.svg', making sure you (1) flip the image along the $y$-axis (i.e., left-right mirror) and update each region's Title to end with '_L' rather than '_R'.</p>"},{"location":"custom_segmentation/#combining-the-left-and-right-hemispheres-into-one-image","title":"Combining the left and right hemispheres into one image","text":"<p>Once you have both hemispheres traced, the last step here is to copy-paste the left and right hemisphere vector graphics into the same image for an SVG corresponding to both hemispheres, named e.g. 'Melbourne_S1_both.svg'. Make sure all the individual regions have appropriate Title text fields corresponding to the region name, face, and hemisphere.</p> <p></p>"},{"location":"custom_segmentation/#organizing-the-file-structure-correctly-for-your-custom-atlas","title":"\ud83d\uddc2\ufe0f Organizing the file structure correctly for your custom atlas","text":"<p>Once you have all your regions traced in the left and right hemispheres for your segmentation, copy the SVGs to the <code>subcortex_visualization/data/</code> folder (for the Python package) and the <code>subcortexVisualizationR/inst/extdata/</code> folder (for the R package) with the following structure:</p> <pre><code># Python package file structure\nsubcortex_visualization/\n    data/\n        - My_Atlas_both.svg\n        - My_Atlas_L.svg\n        - My_Atlas_R.svg\n\n# R package file structure\nsubcortexVisualizationR/\n    inst/\n        extdata/\n        - My_Atlas_both.svg\n        - My_Atlas_L.svg\n        - My_Atlas_R.svg\n</code></pre>"},{"location":"custom_segmentation/#lookup-tables-to-indicate-the-order-for-drawing-regions","title":"\ud83d\udd0e Lookup tables to indicate the order for drawing regions","text":"<p>Home stretch, you're almost done \ud83c\udfc3\u200d\u2640\ufe0f</p> <p>One of the last steps to get plotting with your custom atlas to create a lookup table for each of the three SVG images (left, right, and both hemispheres). Each table, in .csv format, should have the following four columns:  </p> <ol> <li><code>region</code>: name of the region (e.g., 'accumbens')</li> <li><code>face</code>: which face to plot (e.g., 'lateral')</li> <li><code>plot_order</code>: in which order should this region be plotted? A value of 1 means this region will be drawn first (i.e., on the bottom) and higher values mean the region will be drawn higher in the stack (i.e., closer to the top). This is only relevant if some regions are overlapping and you care about plotting order.</li> <li><code>Hemisphere</code>: which hemisphere the corresponding region belongs to (should be all 'L' for left hemisphere and 'R' for right hemisphere).</li> </ol> <p>Take a look at the examine lookup tables provided for the Melbourne Subcortex Atlas S1 segmentation in the [left hemisphere], [right hemisphere], and both hemispheres to see exactly how these files are organized. In the case of the Melbourne Subcortex Atlas S1 subcortical atlas, this corresponds to three lookup table files (linked to the actual files for this atlas for reference):</p> <ul> <li>Melbourne_S1_L_ordering.csv</li> <li>Melbourne_S1_R_ordering.csv</li> <li>Melbourne_S1_both_ordering.csv</li> </ul>"},{"location":"custom_segmentation/#re-installing-the-package-with-the-new-atlas","title":"Re-installing the package with the new atlas","text":"<p>And with that, you'll just need to reinstall the Python and/or R package once you've added your new vector graphics and lookup tables!  That can be accomplished by simply navigating to the base level of this repository and running the following for Python:</p> <pre><code># Change to where you've cloned this repo\ncd /path/to/github/subcortex_visualization \n\n# To reinstall the subcortex-visualization package\npython3 -m pip install . \n</code></pre> <p>And for R, run from R (in either the terminal or Rstudio):</p> <pre><code># Change to where you've cloned this repo\nsetwd(\"/path/to/github/subcortex_visualization/subcortexVisualizationR\")\n\n# TO reinstall the subcortexVisualizationR package\nremotes::install_local(\".\")\n</code></pre>"},{"location":"installation/","title":"Python","text":""},{"location":"installation/#direct-installation-from-pypi","title":"Direct installation from PyPI","text":"<p>This package can be installed directly with pip from the PyPI repository:</p> <pre><code>pip install subcortex-visualization\n</code></pre>"},{"location":"installation/#cloning-with-github","title":"Cloning with GitHub","text":"<p>Alternatively, you can clone this repository from GitHub and then install from your local version:</p> <pre><code>git clone https://github.com/anniegbryant/subcortex_visualization.git\ncd subcortex_visualization\npip install .\n</code></pre> <p>This option is good if you want to make any modifications, including adding your own atlas.</p>"},{"location":"installation/#r","title":"R","text":""},{"location":"installation/#installing-from-github","title":"Installing from GitHub","text":"<p>To install the R version of this package (<code>subcortexVisualizationR</code>), run the following in R (either in the terminal or in RStudio):</p> <pre><code># if not already installed\ninstall.packages(\"remotes\")\n\n# then install subcortexVisualizationR\nremotes::install_github(\"anniegbryant/subcortex_visualization\", subdir = \"subcortexVisualizationR\")\n</code></pre>"},{"location":"python_tutorial/","title":"Usage (Python)","text":"In\u00a0[1]: Copied! <pre>import pandas as pd\nimport numpy as np\nimport random\nimport matplotlib\nimport matplotlib.pyplot as plt\nimport matplotlib.colors as mcolors\n\nfrom subcortex_visualization.plotting import plot_subcortical_data\n</pre> import pandas as pd import numpy as np import random import matplotlib import matplotlib.pyplot as plt import matplotlib.colors as mcolors  from subcortex_visualization.plotting import plot_subcortical_data <p>First, let's create a simple dataframe with the left hemisphere cortical regions, assigning a different value to each region for visual clarity. Note that all data passed to <code>plot_subcortical_data</code> needs to follow the same three-column structure as shown below: <code>region</code> (the name of the subcortical region with the same nomenclature as shown), <code>value</code> (the value to be plotted in the subcortex map), and <code>Hemisphere</code> (either 'L', 'R', or 'both').</p> In\u00a0[2]: Copied! <pre>example_subcortex_data = pd.DataFrame({\"region\": [\"accumbens\", \"amygdala\", \"caudate\", \"hippocampus\", \"pallidum\", \"putamen\", \"thalamus\"], \n                                       \"value\": range(7)}).assign(Hemisphere = \"L\")\n\nexample_subcortex_data\n</pre> example_subcortex_data = pd.DataFrame({\"region\": [\"accumbens\", \"amygdala\", \"caudate\", \"hippocampus\", \"pallidum\", \"putamen\", \"thalamus\"],                                         \"value\": range(7)}).assign(Hemisphere = \"L\")  example_subcortex_data Out[2]: region value Hemisphere 0 accumbens 0 L 1 amygdala 1 L 2 caudate 2 L 3 hippocampus 3 L 4 pallidum 4 L 5 putamen 5 L 6 thalamus 6 L <p>Now, we can plot this data with the <code>plasma</code> colormap as an example in the left cortex. Note the following arguments:</p> <ul> <li><code>subcortex_data</code>: The three-column dataframe shown above</li> <li><code>atlas</code>: The name of the atlas to plot (currently, only 'aseg' is supported)</li> <li><code>line_thickness</code>: How thick the lines around each subcortical region should be drawn, in mm (default is 1.5)</li> <li><code>line_color</code>: What color the lines around each subcortical region should be (default is 'black')</li> <li><code>hemisphere</code>: Which hemisphere ('L' or 'R') the <code>subcortex_data</code> is from; can also be 'both' (default is 'L')</li> <li><code>fill_title</code>: Name to add to legend</li> <li><code>cmap</code>: Name of colormap (e.g., 'plasma' or 'viridis') or a <code>matplotlib.colors.Colormap</code> (default is 'viridis')</li> <li><code>vmin</code>: Min fill value; this is optional, and you would only want to use this to manually constrain the fill range to match another figure</li> <li><code>vmax</code>: Max fill value; this is optional, and you would only want to use this to manually constrain the fill range to match another figure</li> </ul> In\u00a0[3]: Copied! <pre>plot_subcortical_data(subcortex_data=example_subcortex_data, atlas = 'aseg',\n                      line_thickness=1.5, line_color='black',\n                          hemisphere='L', fill_title = \"aseg region index\", cmap='plasma', \n                          vmin=None, vmax=None)\n</pre> plot_subcortical_data(subcortex_data=example_subcortex_data, atlas = 'aseg',                       line_thickness=1.5, line_color='black',                           hemisphere='L', fill_title = \"aseg region index\", cmap='plasma',                            vmin=None, vmax=None) <p>If we wanted to plot this with the <code>inferno</code> color palette instead, just swap out the <code>cmap</code> argument values:</p> In\u00a0[4]: Copied! <pre>plot_subcortical_data(subcortex_data=example_subcortex_data, atlas = 'aseg', \n                      hemisphere='L', fill_title = \"aseg region index\", cmap='inferno')\n</pre> plot_subcortical_data(subcortex_data=example_subcortex_data, atlas = 'aseg',                        hemisphere='L', fill_title = \"aseg region index\", cmap='inferno') <p>By default, <code>plot_subcortical_data</code> will plot the index values of each region, so we actually don't need to pass in a dataframe for this visualization purpose. Here, we can plot the region indices for the Melbourne Subcortex S1 atlas in right hemisphere without passing in any data:</p> In\u00a0[5]: Copied! <pre>plot_subcortical_data(atlas = 'Melbourne_S1', hemisphere='R', \n                      fill_title = \"Melbourne Subcortex S1 atlas region\", \n                      cmap='viridis')\n</pre> plot_subcortical_data(atlas = 'Melbourne_S1', hemisphere='R',                        fill_title = \"Melbourne Subcortex S1 atlas region\",                        cmap='viridis') <p>To plot both hemispheres using gray lines of 2mm thickness, we can set the <code>hemisphere</code> argument to 'both' and adjust the <code>line_thickness</code> and <code>line_color</code> arguments accordingly:</p> In\u00a0[6]: Copied! <pre>plot_subcortical_data(atlas = 'Melbourne_S1', hemisphere='both', \n                      line_color='gray', line_thickness=2,\n                      fill_title = \"Melbourne Subcortex S1 atlas region\", cmap='viridis')\n</pre> plot_subcortical_data(atlas = 'Melbourne_S1', hemisphere='both',                        line_color='gray', line_thickness=2,                       fill_title = \"Melbourne Subcortex S1 atlas region\", cmap='viridis') <p>We can also use the S2 level of granularity from the Melbourne Subcortex (Tian 2020) Atlas:</p> In\u00a0[7]: Copied! <pre>plot_subcortical_data(atlas = 'Melbourne_S2', hemisphere='both', \n                      fill_title = \"Melbourne Subcortex S2 atlas\", cmap='hsv')\n</pre> plot_subcortical_data(atlas = 'Melbourne_S2', hemisphere='both',                        fill_title = \"Melbourne Subcortex S2 atlas\", cmap='hsv') <p>Lastly, let's view the atlas for (1) AICHA subcortex; (2) Brainnetome subcortex; and (3) SUIT cerebellum:</p> In\u00a0[8]: Copied! <pre># AICHA\nplot_subcortical_data(atlas = 'AICHA', hemisphere='both', \n                      fill_title = \"AICHA subcortex atlas\", cmap='hsv')\n</pre> # AICHA plot_subcortical_data(atlas = 'AICHA', hemisphere='both',                        fill_title = \"AICHA subcortex atlas\", cmap='hsv') In\u00a0[9]: Copied! <pre># Brainnetome\nplot_subcortical_data(atlas = 'Brainnetome', hemisphere='both', \n                      fill_title = \"Brainnetome subcortex atlas\", cmap='hsv')\n</pre> # Brainnetome plot_subcortical_data(atlas = 'Brainnetome', hemisphere='both',                        fill_title = \"Brainnetome subcortex atlas\", cmap='hsv') In\u00a0[10]: Copied! <pre># SUIT cerebellum\nplot_subcortical_data(atlas = 'SUIT', hemisphere='both', \n                      fill_title = \"SUIT cerebellum atlas\", cmap='hsv')\n</pre> # SUIT cerebellum plot_subcortical_data(atlas = 'SUIT', hemisphere='both',                        fill_title = \"SUIT cerebellum atlas\", cmap='hsv') In\u00a0[11]: Copied! <pre>np.random.seed(127)\n\nexample_continuous_data_L = pd.DataFrame({\"region\": [\"accumbens\", \"amygdala\", \"caudate\", \"hippocampus\", \"pallidum\", \"putamen\", \"thalamus\"],\n                                          \"value\": np.random.normal(0, 1, 7)}).assign(Hemisphere = \"L\")\nexample_continuous_data_R = pd.DataFrame({\"region\": [\"accumbens\", \"amygdala\", \"caudate\", \"hippocampus\", \"pallidum\", \"putamen\", \"thalamus\"],\n                                            \"value\": np.random.normal(0, 1, 7)}).assign(Hemisphere = \"R\")\nexample_continuous_data = pd.concat([example_continuous_data_L, example_continuous_data_R], axis=0)\n\n# See what the left hemisphere data, randomly sampled from a normal distribution, looks like\nexample_continuous_data_L\n</pre> np.random.seed(127)  example_continuous_data_L = pd.DataFrame({\"region\": [\"accumbens\", \"amygdala\", \"caudate\", \"hippocampus\", \"pallidum\", \"putamen\", \"thalamus\"],                                           \"value\": np.random.normal(0, 1, 7)}).assign(Hemisphere = \"L\") example_continuous_data_R = pd.DataFrame({\"region\": [\"accumbens\", \"amygdala\", \"caudate\", \"hippocampus\", \"pallidum\", \"putamen\", \"thalamus\"],                                             \"value\": np.random.normal(0, 1, 7)}).assign(Hemisphere = \"R\") example_continuous_data = pd.concat([example_continuous_data_L, example_continuous_data_R], axis=0)  # See what the left hemisphere data, randomly sampled from a normal distribution, looks like example_continuous_data_L Out[11]: region value Hemisphere 0 accumbens -0.571809 L 1 amygdala 0.029624 L 2 caudate 0.562592 L 3 hippocampus -0.647652 L 4 pallidum -0.845436 L 5 putamen 0.106565 L 6 thalamus 1.732392 L <p>Left hemisphere:</p> In\u00a0[12]: Copied! <pre>plot_subcortical_data(subcortex_data=example_continuous_data_L, atlas = 'aseg',\n                      hemisphere='L', fill_title = \"Normal distribution sample, aseg atlas\", \n                      cmap='viridis')\n</pre> plot_subcortical_data(subcortex_data=example_continuous_data_L, atlas = 'aseg',                       hemisphere='L', fill_title = \"Normal distribution sample, aseg atlas\",                        cmap='viridis') <p>Right hemisphere:</p> In\u00a0[13]: Copied! <pre>plot_subcortical_data(subcortex_data=example_continuous_data_R, atlas = 'aseg',\n                      hemisphere='R', fill_title = \"Normal distribution sample, aseg atlas\", \n                      cmap='viridis')\n</pre> plot_subcortical_data(subcortex_data=example_continuous_data_R, atlas = 'aseg',                       hemisphere='R', fill_title = \"Normal distribution sample, aseg atlas\",                        cmap='viridis') <p>Both hemispheres together:</p> In\u00a0[14]: Copied! <pre>plot_subcortical_data(subcortex_data=example_continuous_data, atlas = 'aseg', \n                      hemisphere='both', fill_title = \"Normal distribution sample, aseg atlas\", \n                      cmap='viridis')\n</pre> plot_subcortical_data(subcortex_data=example_continuous_data, atlas = 'aseg',                        hemisphere='both', fill_title = \"Normal distribution sample, aseg atlas\",                        cmap='viridis') <p>You can pass in a custom colormap too! For example, if you want to fill in with a gradient ranging from white to red:</p> In\u00a0[15]: Copied! <pre>white_to_purple_cmap = mcolors.LinearSegmentedColormap.from_list(\"white_to_purple\", [\"white\", \"purple\"])\n\nplot_subcortical_data(subcortex_data=example_continuous_data, atlas = 'aseg', \n                      hemisphere='both', fill_title = \"Normal distribution sample\", \n                      cmap=white_to_purple_cmap)\n</pre> white_to_purple_cmap = mcolors.LinearSegmentedColormap.from_list(\"white_to_purple\", [\"white\", \"purple\"])  plot_subcortical_data(subcortex_data=example_continuous_data, atlas = 'aseg',                        hemisphere='both', fill_title = \"Normal distribution sample\",                        cmap=white_to_purple_cmap) <p>Since this data has positive and negative values, we can pass in a color palette from blue (negative) to white (0) to red (positive). <code>plot_subcortical_data</code> takes an argument <code>midpoint</code> that specifies the center point for the color palette. Setting this to 0 here enforces the center value to be white. Without setting vmin/vmax explicitly, the color range will be defined symmetrically around <code>midpoint</code> to capture the full range of the data.</p> In\u00a0[16]: Copied! <pre>white_blue_red_cmap = mcolors.LinearSegmentedColormap.from_list(\"BlueWhiteRed\", [\"blue\", \"white\", \"red\"])\n\nplot_subcortical_data(subcortex_data=example_continuous_data, atlas = 'aseg',  \n                      hemisphere='both', fill_title = \"Normal distribution sample\", \n                      cmap=white_blue_red_cmap, midpoint=0)\n</pre> white_blue_red_cmap = mcolors.LinearSegmentedColormap.from_list(\"BlueWhiteRed\", [\"blue\", \"white\", \"red\"])  plot_subcortical_data(subcortex_data=example_continuous_data, atlas = 'aseg',                         hemisphere='both', fill_title = \"Normal distribution sample\",                        cmap=white_blue_red_cmap, midpoint=0)"},{"location":"python_tutorial/#example-data-just-to-show-the-different-regions","title":"Example data just to show the different regions\u00b6","text":""},{"location":"python_tutorial/#lets-simulate-and-visualize-some-continuous-data","title":"Let's simulate and visualize some continuous data\u00b6","text":""}]}